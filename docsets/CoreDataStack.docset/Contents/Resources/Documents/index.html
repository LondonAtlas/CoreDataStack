<!DOCTYPE html>
<html lang="en">
  <head>
    <title>CoreDataStack  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset="utf-8">
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    <meta property="og:site_name" content="Core Data Stack Programming Guide">
<meta property="og:description" content="The BNR Core Data Stack is a small framework, written in Swift, that makes it easy to quickly set up a multi-threading ready Core Data stack.">
<meta property="og:image" content="//www.bignerdranch.com/img/bnr-logo-square.png">
<link rel="shortcut icon" type="image/x-icon" href="//www.bignerdranch.com/favicon.png">

  </head>
  <body>


    <a title="CoreDataStack  Reference"></a>

    <header class="header">
      <p class="header-col header-col--primary">
        <a class="header-link" href="index.html">
          CoreDataStack Docs
        </a>
         (96% documented)
      </p>
    
        <p class="header-col header-col--secondary">
          <a class="header-link" href="https://github.com/bignerdranch/CoreDataStack">
            <img class="header-icon" src="img/gh.png"/>
            View on GitHub
          </a>
        </p>
    
        <p class="header-col header-col--secondary">
          <a class="header-link" href="dash-feed://http%3A%2F%2Fbignerdranch%2Egithub%2Eio%2FCoreDataStack%2Fdocsets%2FCoreDataStack%2Exml">
            <img class="header-icon" src="img/dash.png"/>
            Install in Dash
          </a>
        </p>
    </header>

    <p class="breadcrumbs">
      <a class="breadcrumb" href="index.html">CoreDataStack Reference</a>
      <img class="carat" src="img/carat.png" />
      CoreDataStack  Reference
    </p>

    <div class="content-wrapper">
      <nav class="navigation">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Type Safe Monitors.html">Type Safe Monitors</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/EntityMonitor.html">EntityMonitor</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/EntityMonitorDelegate.html">EntityMonitorDelegate</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/FetchedResultsController.html">FetchedResultsController</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/FetchedResultsControllerDelegate.html">FetchedResultsControllerDelegate</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Extensions.html">Extensions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/NSFetchRequestResult.html">NSFetchRequestResult</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/NSManagedObjectContext.html">NSManagedObjectContext</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/NSPersistentStoreCoordinator.html">NSPersistentStoreCoordinator</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/Bundle.html">Bundle</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Supporting Structs and Enums.html">Supporting Structs and Enums</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/FetchedResultsObjectChange.html">FetchedResultsObjectChange</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/FetchedResultsSectionChange.html">FetchedResultsSectionChange</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/FetchedResultsSectionInfo.html">FetchedResultsSectionInfo</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/FireFrequency.html">FireFrequency</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Deprecated.html">Deprecated</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/CoreDataStack.html">CoreDataStack</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/CoreDataStack/Error.html">– Error</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/CoreDataStack/CoordinatorResult.html">– CoordinatorResult</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/CoreDataStack/BatchContextResult.html">– BatchContextResult</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/CoreDataStack/SetupResult.html">– SetupResult</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/CoreDataStack/SuccessResult.html">– SuccessResult</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/CoreDataModelable.html">CoreDataModelable</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">

        <section class="section">
          <div class="section-content">
            
            <a href='#bnr-core-data-stack' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h1 id='bnr-core-data-stack'>BNR Core Data Stack</h1>

<p><a href="https://github.com/Carthage/Carthage"><img src="https://img.shields.io/badge/Carthage-compatible-4BC51D.svg?style=flat" alt="Carthage compatible"></a>
<a href="https://cocoapods.org/pods/BNRCoreDataStack"><img src="https://img.shields.io/cocoapods/dt/BNRCoreDataStack.svg" alt="CocoaPods Compatible"></a>
<a href="./LICENSE"><img src="https://img.shields.io/badge/license-MIT-brightgreen.svg" alt="GitHub license"></a>
<a href="https://travis-ci.org/bignerdranch/CoreDataStack"><img src="https://travis-ci.org/bignerdranch/CoreDataStack.svg" alt="Build Status"></a></p>

<p><a href="http://bignerdranch.com"><img src="https://raw.githubusercontent.com/bignerdranch/CoreDataStack/master/Resources/logo.png" alt="Big Nerd Ranch"></a></p>

<p>The BNR Core Data Stack is a small Swift framework
that makes it both easier and safer to use Core Data.</p>
<a href='#a-better-fetched-results-controller-and-delegate' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='a-better-fetched-results-controller-and-delegate'>A better fetched results controller and delegate</h2>

<p>Our <code>FetchedResultsController&lt;ManagedObjectType&gt;</code>
sends Swifty delegate messages, rather than a mess of optionals.</p>

<p>Turn this:</p>
<pre class="highlight swift"><code><span class="kd">func</span> <span class="nf">controller</span><span class="p">(</span>
    <span class="n">_</span> <span class="nv">controller</span><span class="p">:</span> <span class="kt">NSFetchedResultsController</span><span class="o">&lt;</span><span class="kt">NSFetchRequestResult</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="n">didChange</span> <span class="nv">anObject</span><span class="p">:</span> <span class="kt">Any</span><span class="p">,</span>
    <span class="n">at</span> <span class="nv">indexPath</span><span class="p">:</span> <span class="kt">IndexPath</span><span class="p">?,</span>
    <span class="k">for</span> <span class="nv">type</span><span class="p">:</span> <span class="kt">NSFetchedResultsChangeType</span><span class="p">,</span>
    <span class="nv">newIndexPath</span><span class="p">:</span> <span class="kt">IndexPath</span><span class="p">?</span>
<span class="p">)</span> <span class="p">{</span>
    <span class="k">guard</span> <span class="k">let</span> <span class="nv">book</span> <span class="o">=</span> <span class="n">anObject</span> <span class="k">as?</span> <span class="kt">Book</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nf">preconditionFailure</span><span class="p">(</span><span class="s">"Why is this thing an Any anyway? WTH!"</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">switch</span> <span class="n">type</span> <span class="p">{</span>
    <span class="k">case</span> <span class="o">.</span><span class="nv">insert</span><span class="p">:</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">newIndexPath</span> <span class="o">=</span> <span class="n">newIndexPath</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nf">preconditionFailure</span><span class="p">(</span><span class="s">"Insertion to nowheresville? WHY IS THIS OPTIONAL?"</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="nf">print</span><span class="p">(</span><span class="s">"We have a new book! </span><span class="se">\(</span><span class="n">book</span><span class="o">.</span><span class="n">title</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="n">tableView</span><span class="p">?</span><span class="o">.</span><span class="nf">insertRows</span><span class="p">(</span><span class="nv">at</span><span class="p">:</span> <span class="p">[</span><span class="n">newIndexPath</span><span class="p">],</span> <span class="nv">with</span><span class="p">:</span> <span class="o">.</span><span class="n">automatic</span><span class="p">)</span>

    <span class="k">case</span> <span class="o">.</span><span class="nv">delete</span><span class="p">:</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">indexPath</span> <span class="o">=</span> <span class="n">indexPath</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nf">preconditionFailure</span><span class="p">(</span><span class="s">"Deletion you say? Where? WHY IS THIS OPTIONAL?"</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="n">tableView</span><span class="p">?</span><span class="o">.</span><span class="nf">deleteRows</span><span class="p">(</span><span class="nv">at</span><span class="p">:</span> <span class="p">[</span><span class="n">indexPath</span><span class="p">],</span> <span class="nv">with</span><span class="p">:</span> <span class="o">.</span><span class="n">automatic</span><span class="p">)</span>

    <span class="k">case</span> <span class="o">.</span><span class="nv">move</span><span class="p">:</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">newIndexPath</span> <span class="o">=</span> <span class="n">newIndexPath</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nf">preconditionFailure</span><span class="p">(</span><span class="s">"It moved to NOWHERE! WHY IS THIS OPTIONAL?"</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">indexPath</span> <span class="o">=</span> <span class="n">indexPath</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nf">preconditionFailure</span><span class="p">(</span><span class="s">"It moved from NOWHERE?! WHY IS THIS OPTIONAL!"</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="n">tableView</span><span class="p">?</span><span class="o">.</span><span class="nf">moveRow</span><span class="p">(</span><span class="nv">at</span><span class="p">:</span> <span class="n">indexPath</span><span class="p">,</span> <span class="nv">to</span><span class="p">:</span> <span class="n">newIndexPath</span><span class="p">)</span>

    <span class="k">case</span> <span class="o">.</span><span class="nv">update</span><span class="p">:</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">indexPath</span> <span class="o">=</span> <span class="n">indexPath</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nf">preconditionFailure</span><span class="p">(</span><span class="s">"I give up! Remind me, why are we using Swift, again?"</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="n">tableView</span><span class="p">?</span><span class="o">.</span><span class="nf">reloadRows</span><span class="p">(</span><span class="nv">at</span><span class="p">:</span> <span class="p">[</span><span class="n">indexPath</span><span class="o">!</span><span class="p">],</span> <span class="nv">with</span><span class="p">:</span> <span class="o">.</span><span class="n">automatic</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>Into this:</p>
<pre class="highlight swift"><code><span class="kd">func</span> <span class="nf">fetchedResultsController</span><span class="p">(</span>
    <span class="n">_</span> <span class="nv">controller</span><span class="p">:</span> <span class="kt">FetchedResultsController</span><span class="o">&lt;</span><span class="kt">Book</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="n">didChangeObject</span> <span class="nv">change</span><span class="p">:</span> <span class="kt">FetchedResultsObjectChange</span><span class="o">&lt;</span><span class="kt">Book</span><span class="o">&gt;</span>
<span class="p">)</span> <span class="p">{</span>
    <span class="k">switch</span> <span class="n">change</span> <span class="p">{</span>
    <span class="k">case</span> <span class="kd">let</span> <span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="n">book</span><span class="p">,</span> <span class="n">indexPath</span><span class="p">):</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"Hey look, it's not an Any! A new book: </span><span class="se">\(</span><span class="n">book</span><span class="o">.</span><span class="n">title</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="n">tableView</span><span class="p">?</span><span class="o">.</span><span class="nf">insertRows</span><span class="p">(</span><span class="nv">at</span><span class="p">:</span> <span class="p">[</span><span class="n">indexPath</span><span class="p">],</span> <span class="nv">with</span><span class="p">:</span> <span class="o">.</span><span class="n">automatic</span><span class="p">)</span>

    <span class="k">case</span> <span class="kd">let</span> <span class="o">.</span><span class="nf">delete</span><span class="p">(</span><span class="n">_</span> <span class="cm">/*book*/</span><span class="p">,</span> <span class="n">indexPath</span><span class="p">):</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"A deletion, and it has a from-where? Finally!"</span><span class="p">)</span>
        <span class="n">tableView</span><span class="p">?</span><span class="o">.</span><span class="nf">deleteRows</span><span class="p">(</span><span class="nv">at</span><span class="p">:</span> <span class="p">[</span><span class="n">indexPath</span><span class="p">],</span> <span class="nv">with</span><span class="p">:</span> <span class="o">.</span><span class="n">automatic</span><span class="p">)</span>

    <span class="k">case</span> <span class="kd">let</span> <span class="o">.</span><span class="nf">move</span><span class="p">(</span><span class="n">_</span> <span class="cm">/*book*/</span><span class="p">,</span> <span class="n">fromIndexPath</span><span class="p">,</span> <span class="n">toIndexPath</span><span class="p">):</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"Whoah, wait, I actually HAVE index paths? Both of them? Yay!"</span><span class="p">)</span>
        <span class="n">tableView</span><span class="p">?</span><span class="o">.</span><span class="nf">moveRow</span><span class="p">(</span><span class="nv">at</span><span class="p">:</span> <span class="n">fromIndexPath</span><span class="p">,</span> <span class="nv">to</span><span class="p">:</span> <span class="n">toIndexPath</span><span class="p">)</span>

    <span class="k">case</span> <span class="kd">let</span> <span class="o">.</span><span class="nf">update</span><span class="p">(</span><span class="n">_</span> <span class="cm">/*book*/</span><span class="p">,</span> <span class="n">indexPath</span><span class="p">):</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"It's almost like I'm actually using Swift and not Obj-C!"</span><span class="p">)</span>
        <span class="n">tableView</span><span class="p">?</span><span class="o">.</span><span class="nf">reloadRows</span><span class="p">(</span><span class="nv">at</span><span class="p">:</span> <span class="p">[</span><span class="n">indexPath</span><span class="p">],</span> <span class="nv">with</span><span class="p">:</span> <span class="o">.</span><span class="n">automatic</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>It also has properly typed sections and subscripting operators.
Because, we are writing Swift, are we not?</p>

<p>As a further bonus, you get our workarounds
for some misbehavior of Core Data that
contradicts the documentation, like this one:</p>
<pre class="highlight plaintext"><code>// Work around a bug in Xcode 7.0 and 7.1 when running on iOS 8 - updated objects
// sometimes result in both an Update *and* an Insert call to didChangeObject,
// … (explanation continues) …
</code></pre>
<a href='#convenient-store-change-listening' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='convenient-store-change-listening'>Convenient store change listening</h2>

<p>Our <code>EntityMonitor&lt;ManagedObjectType&gt;</code>
makes it easy to listen to all changes for a given <code>ManagedObjectType</code>:</p>
<pre class="highlight swift"><code><span class="cm">/* EXAMPLE: NOTIFYING WHEN A MOC SAVES AUTHOR CHANGES */</span>
<span class="k">let</span> <span class="nv">authorMonitor</span> <span class="o">=</span> <span class="kt">EntityMonitor</span><span class="o">&lt;</span><span class="kt">Author</span><span class="o">&gt;</span><span class="p">(</span><span class="nv">context</span><span class="p">:</span> <span class="n">moc</span><span class="p">,</span> <span class="nv">entity</span><span class="p">:</span> <span class="n">authorEntityDescription</span><span class="p">,</span> <span class="nv">frequency</span><span class="p">:</span> <span class="o">.</span><span class="n">onSave</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">authorMonitorDelegate</span> <span class="o">=</span> <span class="kt">AuthorMonitorDelegate</span><span class="p">()</span>
<span class="n">authorMonitor</span><span class="o">.</span><span class="nf">setDelegate</span><span class="p">(</span><span class="n">authorMonitorDelegate</span><span class="p">)</span>


<span class="cm">/* EXAMPLE: AUTHOR MONITOR DELEGATE */</span>
<span class="kd">class</span> <span class="kt">AuthorMonitorDelegate</span><span class="p">:</span> <span class="kt">EntityMonitorDelegate</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">entityMonitorObservedInserts</span><span class="p">(</span>
        <span class="n">_</span> <span class="nv">monitor</span><span class="p">:</span> <span class="kt">EntityMonitor</span><span class="o">&lt;</span><span class="kt">Author</span><span class="o">&gt;</span><span class="p">,</span>
        <span class="nv">entities</span><span class="p">:</span> <span class="kt">Set</span><span class="o">&lt;</span><span class="kt">Author</span><span class="o">&gt;</span>
    <span class="p">)</span> <span class="p">{</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"inserted authors:"</span><span class="p">,</span> <span class="n">entities</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">entityMonitorObservedModifications</span><span class="p">(</span>
        <span class="n">_</span> <span class="nv">monitor</span><span class="p">:</span> <span class="kt">EntityMonitor</span><span class="o">&lt;</span><span class="kt">Author</span><span class="o">&gt;</span><span class="p">,</span>
        <span class="nv">entities</span><span class="p">:</span> <span class="kt">Set</span><span class="o">&lt;</span><span class="kt">Author</span><span class="o">&gt;</span>
    <span class="p">)</span> <span class="p">{</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"modified authors:"</span><span class="p">,</span> <span class="n">entities</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">entityMonitorObservedDeletions</span><span class="p">(</span>
        <span class="n">_</span> <span class="nv">monitor</span><span class="p">:</span> <span class="kt">EntityMonitor</span><span class="o">&lt;</span><span class="kt">Author</span><span class="o">&gt;</span><span class="p">,</span>
        <span class="nv">entities</span><span class="p">:</span> <span class="kt">Set</span><span class="o">&lt;</span><span class="kt">Author</span><span class="o">&gt;</span>
    <span class="p">)</span> <span class="p">{</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"deleted authors:"</span><span class="p">,</span> <span class="n">entities</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<a href='#a-friendlier-managed-object-context' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='a-friendlier-managed-object-context'>A friendlier managed object context</h2>

<p>Extension methods on <code>ManagedObjectContext</code> ensure
saves happen on the right queue
and make your life easier:</p>
<pre class="highlight swift"><code><span class="c1">// Gotta catch 'em all</span>
<span class="k">let</span> <span class="nv">allBooks</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Book</span><span class="o">.</span><span class="nf">allInContext</span><span class="p">(</span><span class="n">moc</span><span class="p">)</span>

<span class="c1">// Or at least one of 'em</span>
<span class="k">let</span> <span class="nv">anyBook</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Book</span><span class="o">.</span><span class="nf">findFirstInContext</span><span class="p">(</span><span class="n">moc</span><span class="p">)</span>

<span class="c1">// Ah, forget it. Rocks fall, everyone dies.</span>
<span class="k">try</span> <span class="kt">Book</span><span class="o">.</span><span class="nf">removeAllInContext</span><span class="p">(</span><span class="n">moc</span><span class="p">)</span>


<span class="c1">// Blocking save, including up through parent contexts,</span>
<span class="c1">// on the appropriate queue.</span>
<span class="k">try</span> <span class="n">moc</span><span class="o">.</span><span class="nf">saveContextToStoreAndWait</span><span class="p">()</span>
</code></pre>
<a href='#interested' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='interested'>Interested?</h2>

<p>Check out the <a href="http://bignerdranch.github.io/CoreDataStack/index.html">documentation!</a></p>

<p>For more details on the design methodology,
read <a href="https://www.bignerdranch.com/blog/introducing-the-big-nerd-ranch-core-data-stack/"><q>Introducing the Big Nerd Ranch Core Data Stack.</q></a></p>

<p><strong>Why <q>Stack</q>?</strong>
Previously, the Core Data Stack provided a full, ready-made Core Data stack.
Apple now provide that themselves in <code>NSPersistentContainer</code>,
so we&rsquo;re free to focus on the other benefits listed above,
and we have [deprecated][#sec:deprecations] our own stack in favor of Apple&rsquo;s.</p>

<p><strong>Swift-Only:</strong>
Note that the Core Data Stack is intended to be used from Swift.
Any use you can make of it from Objective-C is by luck, not design.</p>
<a href='#support' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='support'>Support</h2>

<p>Big Nerd Ranch can <a href="https://www.bignerdranch.com/work/">help you develop your app</a>,
or <a href="https://www.bignerdranch.com/training/">train you or your team</a> in Swift, iOS, and more.
We share what we learn here on GitHub and in <a href="https://www.bignerdranch.com/books/">bookstores near you</a>.</p>

<p>For questions specific to the Core Data Stack, please
<a href="https://github.com/bignerdranch/CoreDataStack/issues/new">open an issue</a>.</p>
<a href='#minimum-requirements' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='minimum-requirements'>Minimum Requirements</h2>
<a href='#running' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h3 id='running'>Running</h3>

<p>Apps using BNR Core Data Stack can be used on devices running these versions
or later:</p>

<ul>
<li>macOS 10.10</li>
<li>tvOS 9.0</li>
<li>iOS 8.0</li>
</ul>
<a href='#building' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h3 id='building'>Building</h3>

<p>To build an app using BNR Core Data Stack, you&rsquo;ll need:</p>

<ul>
<li>Xcode 8.0</li>
<li>Swift 3.0</li>
</ul>
<a href='#a-id-usage-a-usage' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='a-id-usage-a-usage'><a id="usage"></a> Usage</h2>
<a href='#type-safe-monitors' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h3 id='type-safe-monitors'>Type Safe Monitors</h3>
<a href='#fetched-results-controller' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h4 id='fetched-results-controller'>Fetched Results Controller</h4>

<p><code>FetchedResultsController&lt;T&gt;</code> is a type safe wrapper around <code>NSFetchedResultsController</code> using Swift generics.</p>
<a href='#example' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h5 id='example'>Example</h5>

<p>See <a href="./Example/BooksTableViewController.swift">BooksTableViewController.swift</a> for an example.</p>
<a href='#a-id-entity_monitor-a-entity-monitor' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h4 id='a-id-entity_monitor-a-entity-monitor'><a id="entity_monitor"></a> Entity Monitor</h4>

<p><code>EntityMonitor&lt;T&gt;</code> is a class for monitoring inserts, deletes, and updates of a specific <code>NSManagedObject</code> subclass within an <code>NSManagedObjectContext</code>.</p>
<a href='#example' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h5 id='example'>Example</h5>

<p>See <a href="./Tests/EntityMonitorTests.swift">EntityMonitorTests.swift</a> for an example.</p>
<a href='#nsmanagedobject-extensions' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h3 id='nsmanagedobject-extensions'>NSManagedObject Extensions</h3>

<p><code>Adds convenience methods on</code>NSManagedObject` subclasses. These methods make fetching, inserting, deleting, and change management easier.</p>
<a href='#example' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h4 id='example'>Example</h4>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">allBooks</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Book</span><span class="o">.</span><span class="nf">allInContext</span><span class="p">(</span><span class="n">moc</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">anyBook</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Book</span><span class="o">.</span><span class="nf">findFirstInContext</span><span class="p">(</span><span class="n">moc</span><span class="p">)</span>
<span class="k">try</span> <span class="kt">Book</span><span class="o">.</span><span class="nf">removeAllInContext</span><span class="p">(</span><span class="n">moc</span><span class="p">)</span>
</code></pre>
<a href='#installation' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='installation'>Installation</h2>
<a href='#installing-with-a-href-https-github-com-carthage-carthage-carthage-a' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h3 id='installing-with-a-href-https-github-com-carthage-carthage-carthage-a'>Installing with <a href="https://github.com/Carthage/Carthage">Carthage</a></h3>

<p>Add the following to your Cartfile:</p>
<pre class="highlight ruby"><code><span class="n">github</span> <span class="s2">"BigNerdRanch/CoreDataStack"</span>
</code></pre>

<p>Then run <code>carthage update</code>.</p>

<p>In your code, import the framework as <code>CoreDataStack</code>.</p>

<p>Follow the current instructions in <a href="https://github.com/Carthage/Carthage/blob/master/README.md">Carthage&rsquo;s README</a>
for up to date installation instructions.</p>
<a href='#installing-with-a-href-http-cocoapods-org-cocoapods-a' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h3 id='installing-with-a-href-http-cocoapods-org-cocoapods-a'>Installing with <a href="http://cocoapods.org">CocoaPods</a></h3>

<p>Add the following to your <a href="http://guides.cocoapods.org/using/the-podfile.html">Podfile</a>:</p>
<pre class="highlight ruby"><code><span class="n">pod</span> <span class="s1">'BNRCoreDataStack'</span>
</code></pre>

<p>You will also need to make sure you&rsquo;re opting into using frameworks:</p>
<pre class="highlight ruby"><code><span class="n">use_frameworks!</span>
</code></pre>

<p>Then run <code>pod install</code>.</p>

<p>In your code, import the framework as <code>BNRCoreDataStack</code>.</p>
<a href='#contributing' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='contributing'>Contributing</h2>

<p>Please see our <a href="https://github.com/bignerdranch/CoreDataStack/tree/master/.github/CONTRIBUTING.md">guide to contributing to the CoreDataStack</a>.</p>
<a href='#debugging-tips' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='debugging-tips'>Debugging Tips</h2>

<p>To validate that you are honoring all of the threading rules it&rsquo;s common to add the following to a project scheme under <code>Run &gt; Arguments &gt; Arguments Passed On Launch</code>.</p>

<p><code>-com.apple.CoreData.ConcurrencyDebug 1</code></p>

<p>This will throw an exception if you happen to break a threading rule. For more on setting up Launch Arguments check out this <a href="http://nshipster.com/launch-arguments-and-environment-variables/">article by NSHipster</a>.</p>
<a href='#excluding-sensitive-data-from-icloud-and-itunes-backups' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='excluding-sensitive-data-from-icloud-and-itunes-backups'>Excluding sensitive data from iCloud and iTunes backups</h2>

<p>The default store location will be backed up.
If you&rsquo;re storing sensitive information such as health records,
and perhaps if you&rsquo;re storing any personally identifiable information,
you should exclude the store from backup by flagging the URL on disk:</p>
<pre class="highlight swift"><code><span class="cm">/* EXAMPLE: EXCLUDING A FILE FROM BACKUP */</span>
<span class="k">var</span> <span class="nv">excludeFromBackup</span> <span class="o">=</span> <span class="kt">URLResourceValues</span><span class="p">()</span>
<span class="n">excludeFromBackup</span><span class="o">.</span><span class="n">isExcludedFromBackup</span> <span class="o">=</span> <span class="kc">true</span>

<span class="k">let</span> <span class="nv">someParentDirectoryURL</span><span class="p">:</span> <span class="kt">URL</span> <span class="o">=</span> <span class="err">…</span>
<span class="k">var</span> <span class="nv">storeFileURL</span> <span class="o">=</span> <span class="kt">URL</span><span class="p">(</span>
    <span class="nv">string</span><span class="p">:</span> <span class="s">"MyModel.sqlite"</span><span class="p">,</span>
    <span class="nv">relativeTo</span><span class="p">:</span> <span class="n">someParentDirectoryURL</span><span class="p">)</span><span class="o">!</span>
<span class="k">try!</span> <span class="n">storeFileURL</span><span class="o">.</span><span class="nf">setResourceValues</span><span class="p">(</span><span class="n">excludeFromBackup</span><span class="p">)</span>
</code></pre>

<p>You then need to point your persistent container at that location:</p>
<pre class="highlight swift"><code><span class="cm">/* EXAMPLE: AIMING YOUR CONTAINER AT A SPECIFIC URL */</span>
<span class="c1">// Ensure parent directory exists</span>
<span class="k">try!</span> <span class="kt">FileManager</span><span class="o">.</span><span class="k">default</span><span class="o">.</span><span class="nf">createDirectory</span><span class="p">(</span>
    <span class="nv">at</span><span class="p">:</span> <span class="n">storeFileURL</span><span class="o">.</span><span class="nf">deletingLastPathComponent</span><span class="p">(),</span>
    <span class="nv">withIntermediateDirectories</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span>

<span class="c1">// Configure the persistent container to use the specific URL</span>
<span class="n">container</span><span class="o">.</span><span class="n">persistentStoreDescriptions</span> <span class="o">=</span> <span class="p">[</span>
    <span class="kt">NSPersistentStoreDescription</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">storeFileURL</span><span class="p">),</span>
    <span class="p">]</span>
</code></pre>

<p>Prior to <code>NSPersistentContainer</code>, this would be done with Core Data Stack by:</p>
<pre class="highlight swift"><code><span class="cm">/* EXAMPLE: DEPRECATED CORE DATA STACK WITH STORE URL */</span>
<span class="kt">CoreDataStack</span><span class="o">.</span><span class="nf">constructSQLiteStack</span><span class="p">(</span>
    <span class="nv">withModelName</span><span class="p">:</span> <span class="s">"MyModel"</span><span class="p">,</span>
    <span class="nv">withStoreURL</span><span class="p">:</span> <span class="n">storeFileURL</span><span class="p">)</span> <span class="p">{</span> <span class="n">result</span> <span class="k">in</span>
        <span class="k">switch</span> <span class="n">result</span> <span class="p">{</span>
        <span class="k">case</span> <span class="o">.</span><span class="nf">success</span><span class="p">(</span><span class="k">let</span> <span class="nv">stack</span><span class="p">):</span>
            <span class="c1">// Use your new stack</span>

        <span class="k">case</span> <span class="o">.</span><span class="nf">failure</span><span class="p">(</span><span class="k">let</span> <span class="nv">error</span><span class="p">):</span>
            <span class="c1">//handle error ...</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre>
<a href='#deprecations' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='deprecations'>Deprecations</h2>

<!-- GitHub does this "fun" thing where it omits section fragment IDs on
mobile, so we provide our own ID to work around that. -->

<p><a id="sec:deprecations"></a></p>
<a href='#ios-10-0-macos-10-12' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h3 id='ios-10-0-macos-10-12'>iOS 10.0 / macOS 10.12</h3>

<ul>
<li><strong>Deprecated:</strong> The <a href="./Sources/CoreDataStack.swift">CoreDataStack</a> class itself.

<ul>
<li><strong>Replacement:</strong> Use Apple&rsquo;s <a href="https://developer.apple.com/reference/coredata/nspersistentcontainer">NSPersistentContainer</a> instead. The <a href="./Container%20Example/README.md">Container Example</a> demonstrates how to use <code>NSPersistentContainer</code> with the BNR Core Data Stack.</li>
</ul></li>
<li><strong>Deprecated:</strong> The <a href="./Sources/CoreDataModelable.swift">CoreDataModelable</a> protocol.

<ul>
<li><strong>Replacement:</strong> Use the type method <a href="https://developer.apple.com/reference/coredata/nsmanagedobject/1640588-entity"><code>NSManagedObject.entity()</code></a>. Many of the convenience methods formerly available on <code>CoreDataModelable</code> are now offered by BNR Core Data Stack as extension methods on <code>NSManagedObject</code> as <a href="./Sources/NSManagedObject+FetchHelpers.swift"><code>FetchHelpers</code></a>.</li>
</ul></li>
</ul>

          </div>
        </section>


      </article>
    </div>
    <section class="footer">
      <p>© 2014-2016 <a class="link" href="//www.bignerdranch.com" target="_blank" rel="external">Big Nerd Ranch</a> under <a class="link" href="https://raw.githubusercontent.com/bignerdranch/CoreDataStack/master/LICENSE" target="_blank" rel="external">MIT license</a>.</p>
      <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.7.3</a>, a <a class="link" href="http://realm.io" target="_blank" rel="external">Realm</a> project.</p>
    </section>
  </body>
</div>
</html>
